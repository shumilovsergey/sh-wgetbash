{% extends 'base.html' %}
{% block title %}
Редактировать "{{script.name}}" - WgetBash
{% endblock %}
{% block content %}
{% load static %}

<style>
/* Ensure light theme for script edit page */
body {
    background: #ffffff !important;
    color: #0f172a !important;
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .edit-container {
        padding: 16px !important;
    }
    
    .edit-form {
        padding: 24px !important;
    }
    
    .action-buttons {
        flex-direction: column !important;
        gap: 16px !important;
    }
    
    .button-group {
        justify-content: center !important;
    }
}
</style>

<div class="edit-container" style="min-height: 100vh; background: #ffffff; padding: 32px;">
  <div style="max-width: 800px; margin: 0 auto;">
    
    <!-- Header -->
    <div style="margin-bottom: 32px;">
      <h1 style="font-size: 2rem; font-weight: 700; color: #0f172a; margin: 0 0 8px 0;">Редактировать скрипт</h1>
      <p style="font-size: 0.875rem; color: #64748b; margin: 0;">Измените название и содержимое скрипта</p>
    </div>

    <!-- Main Form -->
    <div class="edit-form" style="background: #ffffff; border: 2px solid #e2e8f0; border-radius: 4px; padding: 32px; box-shadow: 0 4px 0 rgba(0, 0, 0, 0.15); margin-bottom: 24px;">
      <form method="post" action="{% url 'api:script_id' script_id=script.id %}">
        {% csrf_token %}
        
        <!-- Script Name -->
        <div style="margin-bottom: 24px;">
          <label for="name" style="display: block; font-size: 0.875rem; font-weight: 600; color: #0f172a; margin-bottom: 8px;">
            Название скрипта
          </label>
          <input 
            required 
            type="text" 
            value="{{script.name}}" 
            autocomplete="off" 
            name="name" 
            id="name"
            maxlength="56" 
            style="width: 100%; padding: 16px; background: #ffffff; border: 2px solid #e2e8f0; border-radius: 4px; color: #0f172a; font-size: 0.875rem; transition: all 0.1s ease-out; outline: none; font-family: 'Inter', sans-serif;"
            placeholder="Введите название скрипта..."
            onfocus="this.style.borderColor='#2563eb'; this.style.boxShadow='0 2px 0 rgba(0, 0, 0, 0.1)';"
            onblur="this.style.borderColor='#e2e8f0'; this.style.boxShadow='none';"
          >
          <p style="font-size: 0.75rem; color: #64748b; margin: 8px 0 0 0;">Максимум 56 символов</p>
        </div>

        <!-- Script Content -->
        <div style="margin-bottom: 32px;">
          <label for="text" style="display: block; font-size: 0.875rem; font-weight: 600; color: #0f172a; margin-bottom: 8px;">
            Содержимое скрипта
          </label>
          <textarea 
            autocomplete="off" 
            required 
            name="text" 
            id="text"
            rows="20"
            style="width: 100%; min-height: 400px; padding: 16px; background: #ffffff; border: 2px solid #e2e8f0; border-radius: 4px; color: #0f172a; font-size: 0.875rem; transition: all 0.1s ease-out; outline: none; font-family: 'JetBrains Mono', 'Fira Code', 'Monaco', 'Consolas', monospace; line-height: 1.5; resize: vertical;"
            placeholder="#!/bin/bash&#10;&#10;# Ваш bash скрипт здесь..."
            onfocus="this.style.borderColor='#2563eb'; this.style.boxShadow='0 2px 0 rgba(0, 0, 0, 0.1)';"
            onblur="this.style.borderColor='#e2e8f0'; this.style.boxShadow='none';"
          >{{script.text}}</textarea>
          <p style="font-size: 0.75rem; color: #64748b; margin: 8px 0 0 0;">
            Напишите ваш bash скрипт. Заголовок #!/bin/bash будет добавлен автоматически при генерации.
          </p>
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons" style="display: flex; align-items: center; justify-content: space-between; padding-top: 24px; border-top: 2px solid #e2e8f0;">
          <!-- Back Button -->
          <a href="{% url 'api:script_list' %}" 
             style="display: inline-flex; align-items: center; justify-content: center; width: 48px; height: 48px; border-radius: 4px; text-decoration: none; cursor: pointer; border: 2px solid #e2e8f0; outline: none; background: #ffffff; color: #475569; box-shadow: 0 2px 0 rgba(0, 0, 0, 0.1); transition: all 0.1s ease-out;"
             title="Назад к списку"
             onmouseover="this.style.background='#f1f5f9'; this.style.color='#0f172a'; this.style.borderColor='#cbd5e1'; this.style.boxShadow='0 4px 0 rgba(0, 0, 0, 0.15)';"
             onmouseout="this.style.background='#ffffff'; this.style.color='#475569'; this.style.borderColor='#e2e8f0'; this.style.boxShadow='0 2px 0 rgba(0, 0, 0, 0.1)';">
            <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
            </svg>
          </a>
          
          <!-- Action Buttons Group -->
          <div style="display: flex; gap: 12px;">
            <!-- Copy Button -->
            <button onclick="copyToClipboard()" id="copy-btn-main"
                    style="display: inline-flex; align-items: center; justify-content: center; width: 48px; height: 48px; border-radius: 4px; cursor: pointer; border: 2px solid #059669; outline: none; background: #059669; color: white; box-shadow: 0 2px 0 rgba(0, 0, 0, 0.1); transition: all 0.1s ease-out;"
                    title="Скопировать команду"
                    onmouseover="this.style.background='#047857'; this.style.borderColor='#047857'; this.style.transform='translateY(-1px)'; this.style.boxShadow='0 4px 0 rgba(0, 0, 0, 0.15)';"
                    onmouseout="this.style.background='#059669'; this.style.borderColor='#059669'; this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 0 rgba(0, 0, 0, 0.1)';">
              <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
              </svg>
            </button>
            
            <!-- Delete Button -->
            <button type="button" onclick="confirmDelete()" 
                    style="display: inline-flex; align-items: center; justify-content: center; width: 48px; height: 48px; border-radius: 4px; cursor: pointer; border: 2px solid #dc2626; outline: none; background: #dc2626; color: white; box-shadow: 0 2px 0 rgba(0, 0, 0, 0.1); transition: all 0.1s ease-out;"
                    title="Удалить скрипт"
                    onmouseover="this.style.background='#b91c1c'; this.style.borderColor='#b91c1c'; this.style.transform='translateY(-1px)'; this.style.boxShadow='0 4px 0 rgba(0, 0, 0, 0.15)';"
                    onmouseout="this.style.background='#dc2626'; this.style.borderColor='#dc2626'; this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 0 rgba(0, 0, 0, 0.1)';">
              <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
              </svg>
            </button>
            
            <!-- Save Button -->
            <button type="submit" 
                    style="display: inline-flex; align-items: center; justify-content: center; width: 48px; height: 48px; border-radius: 4px; cursor: pointer; border: 2px solid #2563eb; outline: none; background: #2563eb; color: white; box-shadow: 0 2px 0 rgba(0, 0, 0, 0.1); transition: all 0.1s ease-out;"
                    title="Сохранить изменения"
                    onmouseover="this.style.background='#1d4ed8'; this.style.borderColor='#1d4ed8'; this.style.transform='translateY(-1px)'; this.style.boxShadow='0 4px 0 rgba(0, 0, 0, 0.15)';"
                    onmouseout="this.style.background='#2563eb'; this.style.borderColor='#2563eb'; this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 0 rgba(0, 0, 0, 0.1)';">
              <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
              </svg>
            </button>
          </div>
        </div>
      </form>
    </div>

    <!-- Hidden Delete Form -->
    <form id="delete-form" action="{% url 'api:script_delete' script_id=script.id %}" method="POST" style="display: none;">
      {% csrf_token %}
    </form>

  </div>
</div>

<script>
    function copyToClipboard() {
        const textToCopy = "wget https://{{host_dns}}/script_raw/{{script.id}}/ -O script_{{script.id}}.sh && sed -i 's/\\r$//' script_{{script.id}}.sh && chmod +x script_{{script.id}}.sh && sh script_{{script.id}}.sh";
        const btn = document.getElementById('copy-btn-main');
        
        const textarea = document.createElement('textarea');
        textarea.value = textToCopy;
        document.body.appendChild(textarea);
    
        textarea.select();
        document.execCommand('copy');
        document.body.removeChild(textarea);
    
        // Show success feedback
        const originalContent = btn.innerHTML;
        btn.innerHTML = '<svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>';
        btn.style.background = '#059669';
        btn.style.borderColor = '#059669';
        
        setTimeout(() => {
            btn.innerHTML = originalContent;
        }, 1500);
    }
    
    function confirmDelete() {
        if (confirm('Вы уверены?')) {
            document.getElementById('delete-form').submit();
        }
    }
</script>

{% endblock %}